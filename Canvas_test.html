<!doctype html>
<style>
:root {background:#111;color:#eee;white-space:pre}
/*#Canvas {height: 100%; width: 100%}*/
</style>
<script src="Creature.js"></script>
<script>
"use strict";
var mainNeighbourhood = []
/*
function getAllCreatures (Neighbourhood) {  
	var AllCreatures = []
//	AllCreatures.push( Neighbourhood.forEach( Community => Community.getCreatures() ) )
	return AllCreatures;
 }*/ 
//(Community => Community.getCreatures().forEach(creature => creature.step()) )
for(var i = 0; i < 3; i++){
	for(var j = 0; j <3; j++){

		mainNeighbourhood[(i*3+j)] = new Community(i,j,mainNeighbourhood) 
	}
}
//var mainCommunity = new Community(0,0,mainNeighbourhood)

for (var i = 0; i < 7; i++) {
    new Plant(
        mainNeighbourhood[0]
       	//,['red','green','blue'][Math.floor(Math.random()*3)]
		,'green'
       	,Math.floor(250*Math.random())+50
       	,Math.floor(250*Math.random())+50
    )
}

var Canvas = {};
Canvas.Neighbourhood = mainNeighbourhood;

Canvas.redraw = function (Creatures) {
	if(this.reDraw)
	{
	var c = document.getElementById("Canvas");
	var ctx = c.getContext("2d");
	ctx.clearRect(0, 0, c.width, c.height);
		for(var i =0, l =Creatures.length; i < l; i++)
		 { // Draw loop
			Creature = Creatures[i];
			ctx.beginPath();
			ctx.arc(Creature.x,Creature.y,Math.max(Creature.energy,1)/20,0,6.283185307179586); // 6.283185307179586 is 2 * Math.PI 
			ctx.fillStyle = Creature.type;
			ctx.fill();
		 }
//		requestAnimationFrame(this.redraw(this.Community.getCreatures() ) );
//		this.reDraw = false;
	}
}

Canvas.go = function () { 
	this.Interval = setInterval(() => {
    mainNeighbourhood.forEach(Community => Community.getCreatures().forEach(creature => creature.step()) ) 
	},1000/60)
	
	this.reDraw = true;
/*	
	requestAnimationFrame(Canvas.redraw( mainCommunity.getCreatures() ));
*/
	this.ReDrawInterval = setInterval(() => { Canvas.redraw( getAllCreatures(mainNeighbourhood) );
//	    document.body.textContent = mainCommunity.Plants.concat(mainCommunity.Herbis).sort((aa,bb) => bb.energy - aa.energy).map(creature => creature.toString()).join('\n')
	},1000/60) 
}

Canvas.stop = function () { 
		clearInterval(this.Interval)
		clearInterval(this.ReDrawInterval)
//		this.reDraw = false;
}

document.onkeypress = function () { 
		switch(event.which) { 
		case 103: Canvas.go(); break;
		case 115: Canvas.stop(); break;
		default:
		}
};

window.onload = function () {
	document.body.textContent = "Press (G)o to begin simulation \nAnd to (S)top or pause simulation"
	var C = document.createElement("Canvas")
	C.id = "Canvas"
	C.setAttribute("width", window.innerWidth);
	C.setAttribute("height", window.innerHeight);
	document.body.appendChild(C)
	}
</script>
